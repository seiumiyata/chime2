<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>チャイム通知システム</title>
    <meta name="description" content="Teams チャネル宛てチャイム通知PWA">
    <meta name="theme-color" content="#1976d2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="チャイム通知">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icons/192x192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/192x192.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- ローディング画面 -->
        <div id="loading" class="loading-screen">
            <div class="spinner"></div>
            <p>読み込み中...</p>
        </div>

        <!-- エラー表示 -->
        <div id="error-toast" class="error-toast hidden">
            <span class="error-message"></span>
            <button onclick="hideError()" class="error-close">×</button>
        </div>

        <!-- メイン画面 -->
        <div id="main-screen" class="main-screen hidden">
            <!-- ヘッダー -->
            <header class="header">
                <div class="header-left">
                    <button id="back-btn" class="back-btn hidden" onclick="goBack()">
                        ← 戻る
                    </button>
                </div>
                <h1 class="title">
                    🔔 <span id="screen-title">チャイム通知システム</span>
                </h1>
                <div class="header-right">
                    <button id="theme-btn" onclick="toggleTheme()" class="icon-btn">🌙</button>
                    <button id="admin-btn" onclick="toggleAdmin()" class="icon-btn">⚙️</button>
                </div>
            </header>

            <!-- プログレス -->
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>

            <!-- 画面コンテナ -->
            <div class="screen-container">
                <!-- 会社選択画面 -->
                <div id="company-screen" class="screen active">
                    <div class="screen-header">
                        <h2>🏢 会社を選択してください</h2>
                    </div>
                    <div class="search-box">
                        <input type="text" id="company-search" placeholder="🔍 会社名で検索..." onkeyup="searchCompanies()">
                    </div>
                    <div class="button-grid" id="company-grid"></div>
                    <div class="pagination" id="company-pagination"></div>
                </div>

                <!-- 部署選択画面 -->
                <div id="department-screen" class="screen">
                    <div class="screen-header">
                        <h2>🏬 部署を選択してください</h2>
                        <div class="breadcrumb">
                            <span>🏢 <span id="selected-company">-</span></span>
                        </div>
                    </div>
                    <div class="search-box">
                        <input type="text" id="department-search" placeholder="🔍 部署名で検索..." onkeyup="searchDepartments()">
                    </div>
                    <div class="button-grid" id="department-grid"></div>
                    <div class="pagination" id="department-pagination"></div>
                </div>

                <!-- 担当者選択画面 -->
                <div id="member-screen" class="screen">
                    <div class="screen-header">
                        <h2>👤 担当者を選択してください</h2>
                        <div class="breadcrumb">
                            <span>🏢 <span id="selected-company2">-</span></span>
                            <span> › 🏬 <span id="selected-department">-</span></span>
                        </div>
                    </div>
                    <div class="search-box">
                        <input type="text" id="member-search" placeholder="🔍 担当者名で検索..." onkeyup="searchMembers()">
                    </div>
                    <div class="button-grid" id="member-grid"></div>
                    <div class="pagination" id="member-pagination"></div>
                </div>
            </div>
        </div>

        <!-- 管理者画面 -->
        <div id="admin-screen" class="admin-screen hidden">
            <!-- 認証 -->
            <div id="auth-panel" class="auth-panel">
                <div class="auth-card">
                    <h2>🔐 管理者認証</h2>
                    <input type="password" id="admin-password" placeholder="パスワードを入力" onkeypress="handleAuthEnter(event)">
                    <button onclick="adminLogin()" class="btn-primary">ログイン</button>
                    <button onclick="toggleAdmin()" class="btn-secondary">戻る</button>
                </div>
            </div>

            <!-- 管理画面 -->
            <div id="admin-panel" class="admin-panel hidden">
                <header class="admin-header">
                    <h1>⚙️ 管理者画面</h1>
                    <button onclick="adminLogout()" class="btn-secondary">ログアウト</button>
                </header>

                <nav class="admin-nav">
                    <button onclick="showAdminTab('companies')" class="nav-btn active" data-tab="companies">🏢 会社</button>
                    <button onclick="showAdminTab('departments')" class="nav-btn" data-tab="departments">🏬 部署</button>
                    <button onclick="showAdminTab('members')" class="nav-btn" data-tab="members">👤 担当者</button>
                    <button onclick="showAdminTab('settings')" class="nav-btn" data-tab="settings">📢 設定</button>
                </nav>

                <div class="admin-content">
                    <!-- 会社管理 -->
                    <div id="companies-tab" class="admin-tab active">
                        <div class="tab-header">
                            <h3>🏢 会社管理</h3>
                            <button onclick="showAddForm('company')" class="btn-success">+ 追加</button>
                        </div>
                        <div id="company-form" class="add-form hidden">
                            <input type="text" id="company-name" placeholder="会社名を入力">
                            <div class="form-actions">
                                <button onclick="saveCompany()" class="btn-primary">保存</button>
                                <button onclick="hideAddForm('company')" class="btn-secondary">キャンセル</button>
                            </div>
                        </div>
                        <div id="companies-list" class="items-list"></div>
                    </div>

                    <!-- 部署管理 -->
                    <div id="departments-tab" class="admin-tab">
                        <div class="tab-header">
                            <h3>🏬 部署管理</h3>
                            <button onclick="showAddForm('department')" class="btn-success">+ 追加</button>
                        </div>
                        <div id="department-form" class="add-form hidden">
                            <select id="department-company-select">
                                <option value="">会社を選択</option>
                            </select>
                            <input type="text" id="department-name" placeholder="部署名を入力">
                            <div class="form-actions">
                                <button onclick="saveDepartment()" class="btn-primary">保存</button>
                                <button onclick="hideAddForm('department')" class="btn-secondary">キャンセル</button>
                            </div>
                        </div>
                        <div id="departments-list" class="items-list"></div>
                    </div>

                    <!-- 担当者管理 -->
                    <div id="members-tab" class="admin-tab">
                        <div class="tab-header">
                            <h3>👤 担当者管理</h3>
                            <button onclick="showAddForm('member')" class="btn-success">+ 追加</button>
                        </div>
                        <div id="member-form" class="add-form hidden">
                            <select id="member-department-select">
                                <option value="">部署を選択</option>
                            </select>
                            <input type="text" id="member-name" placeholder="担当者名を入力">
                            <div class="form-actions">
                                <button onclick="saveMember()" class="btn-primary">保存</button>
                                <button onclick="hideAddForm('member')" class="btn-secondary">キャンセル</button>
                            </div>
                        </div>
                        <div id="members-list" class="items-list"></div>
                    </div>

                    <!-- 設定 -->
                    <div id="settings-tab" class="admin-tab">
                        <div class="tab-header">
                            <h3>📢 Teams設定</h3>
                        </div>
                        <div class="settings-form">
                            <label>Webhook URL:</label>
                            <input type="url" id="webhook-url" placeholder="https://your-teams-webhook-url">
                            <button onclick="saveWebhook()" class="btn-primary">保存</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 通知結果 -->
        <div id="notification-result" class="notification-result hidden">
            <div class="result-content">
                <div class="result-icon" id="result-icon">✓</div>
                <div class="result-message" id="result-message">通知を送信しました</div>
                <div class="result-detail" id="result-detail">チャイム音を再生してTeams通知を送信しました</div>
            </div>
        </div>

        <!-- 音声波形 -->
        <div id="wave-animation" class="wave-animation hidden">
            <div class="wave-container">
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
            </div>
            <p>🎵 チャイム再生中...</p>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
